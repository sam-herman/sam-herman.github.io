<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
     refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151" />
    </marker>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge> 
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="800" height="600" fill="#f8fafc"/>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="Arial, sans-serif" 
        font-size="18" font-weight="bold" fill="#1f2937">
    Snapshot-Based Coordination: How It Works
  </text>
  
  <!-- Step 1: Initial State -->
  <g id="step1">
    <text x="50" y="80" font-family="Arial, sans-serif" font-size="14" 
          font-weight="bold" fill="#059669">Step 1: Node₁ insertion begins</text>
    
    <!-- Existing graph nodes -->
    <circle cx="100" cy="120" r="12" fill="#3b82f6" stroke="#1e40af" stroke-width="2"/>
    <circle cx="150" cy="140" r="12" fill="#3b82f6" stroke="#1e40af" stroke-width="2"/>
    <circle cx="120" cy="180" r="12" fill="#3b82f6" stroke="#1e40af" stroke-width="2"/>
    <circle cx="180" cy="160" r="12" fill="#3b82f6" stroke="#1e40af" stroke-width="2"/>
    
    <!-- Connections between existing nodes -->
    <line x1="100" y1="120" x2="150" y2="140" stroke="#64748b" stroke-width="2"/>
    <line x1="150" y1="140" x2="180" y2="160" stroke="#64748b" stroke-width="2"/>
    <line x1="120" y1="180" x2="100" y2="120" stroke="#64748b" stroke-width="2"/>
    
    <!-- Node₁ being inserted (in progress) -->
    <circle cx="220" cy="120" r="12" fill="#f59e0b" stroke="#d97706" stroke-width="3" 
            filter="url(#glow)"/>
    <text x="240" y="125" font-family="Arial, sans-serif" font-size="12" fill="#d97706">Node₁</text>
    <text x="240" y="138" font-family="Arial, sans-serif" font-size="10" fill="#7c2d12">(inserting...)</text>
    
    <!-- Search lines from Node₁ -->
    <line x1="220" y1="120" x2="180" y2="160" stroke="#f59e0b" stroke-width="2" 
          stroke-dasharray="5,5" opacity="0.7"/>
    <line x1="220" y1="120" x2="150" y2="140" stroke="#f59e0b" stroke-width="2" 
          stroke-dasharray="5,5" opacity="0.7"/>
  </g>
  
  <!-- Arrow -->
  <path d="M 320 150 L 350 150" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Step 2: Node₂ Takes Snapshot -->
  <g id="step2">
    <text x="370" y="80" font-family="Arial, sans-serif" font-size="14" 
          font-weight="bold" fill="#7c3aed">Step 2: Node₂ takes snapshot</text>
    
    <!-- Existing graph nodes (snapshot) -->
    <rect x="380" y="100" width="200" height="120" fill="#ede9fe" stroke="#7c3aed" 
          stroke-width="2" stroke-dasharray="3,3" rx="5"/>
    <text x="480" y="118" text-anchor="middle" font-family="Arial, sans-serif" 
          font-size="11" fill="#5b21b6">Graph Snapshot</text>
    
    <circle cx="420" cy="140" r="10" fill="#3b82f6" stroke="#1e40af" stroke-width="1.5"/>
    <circle cx="460" cy="160" r="10" fill="#3b82f6" stroke="#1e40af" stroke-width="1.5"/>
    <circle cx="440" cy="190" r="10" fill="#3b82f6" stroke="#1e40af" stroke-width="1.5"/>
    <circle cx="500" cy="170" r="10" fill="#3b82f6" stroke="#1e40af" stroke-width="1.5"/>
    
    <!-- Ongoing insertions list -->
    <rect x="590" y="100" width="100" height="80" fill="#fef3c7" stroke="#f59e0b" 
          stroke-width="2" rx="5"/>
    <text x="640" y="118" text-anchor="middle" font-family="Arial, sans-serif" 
          font-size="11" fill="#92400e">Ongoing Insertions</text>
    <circle cx="620" cy="140" r="8" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
    <text x="635" y="145" font-family="Arial, sans-serif" font-size="10" fill="#92400e">Node₁</text>
    
    <!-- Node₂ -->
    <circle cx="480" cy="250" r="12" fill="#dc2626" stroke="#b91c1c" stroke-width="3" 
            filter="url(#glow)"/>
    <text x="500" y="255" font-family="Arial, sans-serif" font-size="12" fill="#dc2626">Node₂</text>
  </g>
  
  <!-- Arrow down -->
  <path d="M 480 280 L 480 320" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Step 3: Combined Search -->
  <g id="step3">
    <text x="370" y="350" font-family="Arial, sans-serif" font-size="14" 
          font-weight="bold" fill="#dc2626">Step 3: Node₂ searches combined view</text>
    
    <!-- Search arrows from Node₂ to both snapshot and ongoing -->
    <path d="M 480 380 Q 450 390 440 410" stroke="#dc2626" stroke-width="2" 
          stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
    <path d="M 480 380 Q 550 390 620 410" stroke="#dc2626" stroke-width="2" 
          stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
    
    <!-- Combined view representation -->
    <rect x="380" y="420" width="280" height="80" fill="#f0fdf4" stroke="#059669" 
          stroke-width="2" rx="5"/>
    <text x="520" y="440" text-anchor="middle" font-family="Arial, sans-serif" 
          font-size="12" font-weight="bold" fill="#059669">Combined Search View</text>
    
    <!-- Nodes in combined view -->
    <circle cx="420" cy="465" r="8" fill="#3b82f6" stroke="#1e40af" stroke-width="1"/>
    <circle cx="450" cy="475" r="8" fill="#3b82f6" stroke="#1e40af" stroke-width="1"/>
    <circle cx="480" cy="465" r="8" fill="#3b82f6" stroke="#1e40af" stroke-width="1"/>
    <circle cx="510" cy="475" r="8" fill="#3b82f6" stroke="#1e40af" stroke-width="1"/>
    <circle cx="580" cy="465" r="8" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
    
    <text x="420" y="485" text-anchor="middle" font-family="Arial, sans-serif" 
          font-size="8" fill="#374151">Existing</text>
    <text x="580" y="485" text-anchor="middle" font-family="Arial, sans-serif" 
          font-size="8" fill="#92400e">Node₁</text>
  </g>
  
  <!-- Arrow right -->
  <path d="M 680 460 L 720 460" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Step 4: Result -->
  <g id="step4">
    <text x="600" y="530" font-family="Arial, sans-serif" font-size="14" 
          font-weight="bold" fill="#059669">Result: Optimal Connections</text>
    
    <!-- Final graph with connections -->
    <circle cx="650" cy="550" r="10" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
    <circle cx="700" cy="550" r="10" fill="#dc2626" stroke="#b91c1c" stroke-width="2"/>
    <circle cx="675" cy="580" r="8" fill="#3b82f6" stroke="#1e40af" stroke-width="1"/>
    
    <!-- Connections -->
    <line x1="650" y1="550" x2="700" y2="550" stroke="#059669" stroke-width="3"/>
    <line x1="650" y1="550" x2="675" y2="580" stroke="#64748b" stroke-width="2"/>
    <line x1="700" y1="550" x2="675" y2="580" stroke="#64748b" stroke-width="2"/>
    
    <text x="625" y="570" font-family="Arial, sans-serif" font-size="10" fill="#d97706">Node₁</text>
    <text x="705" y="570" font-family="Arial, sans-serif" font-size="10" fill="#dc2626">Node₂</text>
  </g>
  
  <!-- Key/Legend -->
  <g id="legend">
    <rect x="50" y="520" width="280" height="70" fill="white" stroke="#d1d5db" 
          stroke-width="1" rx="5"/>
    <text x="190" y="540" text-anchor="middle" font-family="Arial, sans-serif" 
          font-size="12" font-weight="bold" fill="#374151">Key</text>
    
    <circle cx="70" cy="555" r="6" fill="#3b82f6" stroke="#1e40af" stroke-width="1"/>
    <text x="85" y="560" font-family="Arial, sans-serif" font-size="10" fill="#374151">Existing nodes</text>
    
    <circle cx="180" cy="555" r="6" fill="#f59e0b" stroke="#d97706" stroke-width="1"/>
    <text x="195" y="560" font-family="Arial, sans-serif" font-size="10" fill="#374151">Node₁ (inserting)</text>
    
    <circle cx="70" cy="575" r="6" fill="#dc2626" stroke="#b91c1c" stroke-width="1"/>
    <text x="85" y="580" font-family="Arial, sans-serif" font-size="10" fill="#374151">Node₂ (new)</text>
    
    <line x1="180" y1="575" x2="200" y2="575" stroke="#059669" stroke-width="2"/>
    <text x="210" y="580" font-family="Arial, sans-serif" font-size="10" fill="#374151">New connection</text>
  </g>
</svg>