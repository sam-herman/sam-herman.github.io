<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 860 520" font-family="'Segoe UI', Arial, sans-serif">
    <defs>
        <linearGradient id="bg3" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="#f8f9fa"/>
            <stop offset="100%" stop-color="#e9ecef"/>
        </linearGradient>
        <linearGradient id="s1g" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%" stop-color="#dbeafe"/>
            <stop offset="100%" stop-color="#bfdbfe"/>
        </linearGradient>
        <linearGradient id="s2g" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%" stop-color="#e0e7ff"/>
            <stop offset="100%" stop-color="#c7d2fe"/>
        </linearGradient>
        <linearGradient id="s3g" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%" stop-color="#f3e8ff"/>
            <stop offset="100%" stop-color="#e9d5ff"/>
        </linearGradient>
        <linearGradient id="s4g" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%" stop-color="#fce7f3"/>
            <stop offset="100%" stop-color="#fbcfe8"/>
        </linearGradient>
        <filter id="s3f" x="-1%" y="-2%" width="102%" height="108%">
            <feDropShadow dx="0" dy="1" stdDeviation="2" flood-color="#00000010"/>
        </filter>
    </defs>

    <rect width="860" height="520" rx="10" fill="url(#bg3)" stroke="#dee2e6" stroke-width="1"/>

    <text x="430" y="30" text-anchor="middle" font-size="15" font-weight="700" fill="#1e293b">PLAID Four-Stage Pipeline: Progressive Candidate Filtering</text>
    <text x="430" y="50" text-anchor="middle" font-size="11" fill="#94a3b8">Worked example: 32-token query against 140M passages (MS MARCO)</text>

    <!-- Stage 1 -->
    <rect x="30" y="70" width="800" height="88" rx="8" fill="url(#s1g)" stroke="#93c5fd" stroke-width="1.5" filter="url(#s3f)"/>
    <rect x="30" y="70" width="6" height="88" rx="3" fill="#3b82f6"/>

    <text x="54" y="90" font-size="13" font-weight="700" fill="#1e40af">Stage 1: Centroid Lookup</text>
    <text x="54" y="108" font-size="11" fill="#475569">Each query token → nearest centroids in codebook → retrieve all docs with matching centroid IDs</text>
    <text x="54" y="126" font-size="11" fill="#475569">Data touched: <tspan font-weight="600">centroid IDs only</tspan> (200 bytes/doc) — fits entirely in RAM for 140M docs (~28 GB)</text>
    <text x="54" y="144" font-size="11" fill="#475569">Operation: inverted index lookup on 2-byte centroid IDs — sub-millisecond</text>

    <rect x="660" y="80" width="155" height="66" rx="6" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
    <text x="737" y="100" text-anchor="middle" font-size="10" font-weight="600" fill="#64748b">CANDIDATES</text>
    <text x="737" y="122" text-anchor="middle" font-size="22" font-weight="800" fill="#1e40af">~50,000</text>
    <text x="737" y="138" text-anchor="middle" font-size="10" fill="#64748b">of 140M (0.036%)</text>

    <!-- Arrow 1→2 -->
    <polygon points="425,158 435,170 415,170" fill="#6366f1" opacity="0.5"/>
    <text x="460" y="168" font-size="10" font-weight="600" fill="#6366f1">99.96% eliminated</text>

    <!-- Stage 2 -->
    <rect x="70" y="178" width="720" height="78" rx="8" fill="url(#s2g)" stroke="#a5b4fc" stroke-width="1.5" filter="url(#s3f)"/>
    <rect x="70" y="178" width="6" height="78" rx="3" fill="#6366f1"/>

    <text x="94" y="198" font-size="13" font-weight="700" fill="#4338ca">Stage 2: Centroid Pruning</text>
    <text x="94" y="216" font-size="11" fill="#475569">For each candidate doc, discard centroids with low similarity to <tspan font-weight="600">all</tspan> query tokens</text>
    <text x="94" y="234" font-size="11" fill="#475569">Avg 100 centroids/doc → ~15–25 surviving centroids/doc after pruning (75–85% sparsification)</text>
    <text x="94" y="246" font-size="11" fill="#475569"/>

    <rect x="660" y="185" width="115" height="60" rx="6" fill="#ffffff" stroke="#a5b4fc" stroke-width="1"/>
    <text x="717" y="205" text-anchor="middle" font-size="10" font-weight="600" fill="#64748b">CANDIDATES</text>
    <text x="717" y="225" text-anchor="middle" font-size="20" font-weight="800" fill="#4338ca">~50,000</text>
    <text x="717" y="238" text-anchor="middle" font-size="9" fill="#64748b">(sparser repr.)</text>

    <!-- Arrow 2→3 -->
    <polygon points="425,256 435,268 415,268" fill="#7c3aed" opacity="0.5"/>
    <text x="460" y="266" font-size="10" font-weight="600" fill="#7c3aed">cheaper scoring via sparsity</text>

    <!-- Stage 3 -->
    <rect x="120" y="276" width="620" height="78" rx="8" fill="url(#s3g)" stroke="#c4b5fd" stroke-width="1.5" filter="url(#s3f)"/>
    <rect x="120" y="276" width="6" height="78" rx="3" fill="#7c3aed"/>

    <text x="144" y="296" font-size="13" font-weight="700" fill="#6b21a8">Stage 3: Centroid Interaction Scoring</text>
    <text x="144" y="314" font-size="11" fill="#475569">Approx MaxSim using <tspan font-weight="600">precomputed</tspan> query-to-centroid distances (memoized lookup table)</text>
    <text x="144" y="332" font-size="11" fill="#475569">32 query tokens × 25 surviving centroids = ~800 lookups/doc (vs. 32 × 100 = 3,200 FP ops full)</text>

    <rect x="620" y="283" width="105" height="60" rx="6" fill="#ffffff" stroke="#c4b5fd" stroke-width="1"/>
    <text x="672" y="303" text-anchor="middle" font-size="10" font-weight="600" fill="#64748b">CANDIDATES</text>
    <text x="672" y="325" text-anchor="middle" font-size="20" font-weight="800" fill="#6b21a8">~1,000</text>
    <text x="672" y="337" text-anchor="middle" font-size="9" fill="#64748b">(98% pruned)</text>

    <!-- Arrow 3→4 -->
    <polygon points="425,354 435,366 415,366" fill="#be185d" opacity="0.5"/>
    <text x="460" y="364" font-size="10" font-weight="600" fill="#be185d">98% eliminated</text>

    <!-- Stage 4 -->
    <rect x="180" y="374" width="500" height="78" rx="8" fill="url(#s4g)" stroke="#f9a8d4" stroke-width="1.5" filter="url(#s3f)"/>
    <rect x="180" y="374" width="6" height="78" rx="3" fill="#be185d"/>

    <text x="204" y="394" font-size="13" font-weight="700" fill="#9d174d">Stage 4: Exact MaxSim (Full Decompression)</text>
    <text x="204" y="412" font-size="11" fill="#475569">Decompress <tspan font-weight="600">full residual embeddings</tspan> for ~1,000 docs, compute exact MaxSim</text>
    <text x="204" y="430" font-size="11" fill="#475569">Data touched: 1,000 × 2,000 bytes = <tspan font-weight="600">2 MB</tspan> (vs 140M × 2,000 = 280 GB for brute force)</text>

    <rect x="570" y="381" width="95" height="60" rx="6" fill="#ffffff" stroke="#f9a8d4" stroke-width="1"/>
    <text x="617" y="401" text-anchor="middle" font-size="10" font-weight="600" fill="#64748b">RESULTS</text>
    <text x="617" y="423" text-anchor="middle" font-size="20" font-weight="800" fill="#9d174d">top-k</text>
    <text x="617" y="435" text-anchor="middle" font-size="9" fill="#64748b">exact scores</text>

    <!-- Summary bar -->
    <rect x="30" y="468" width="800" height="40" rx="8" fill="#ffffff" stroke="#e2e8f0" stroke-width="1" filter="url(#s3f)"/>
    <text x="430" y="487" text-anchor="middle" font-size="11" fill="#475569">
        <tspan font-weight="700" fill="#1e293b">Net result:</tspan> 140M docs → 50K → 1K → top-k.
        <tspan font-weight="700" fill="#1e293b">Data decompressed:</tspan> 2 MB (not 280 GB).
        <tspan font-weight="700" fill="#1e293b">Quality:</tspan> identical MRR@10 to full ColBERTv2.
    </text>
</svg>